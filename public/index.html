<html>
  <head>
    <!-- Load Bootstrap/CSS/Popper/Jquery/Socket.io -->
    <link rel="stylesheet" href="bootstrap.min.css"> </link>
    <script src="jquery-3.6.0.min.js"></script>
    <script src="popper.min.js" ></script>
    <script src="bootstrap.min.js" ></script>
    <script src="/socket.io/socket.io.js"></script>

    <title>Guessing Game!</title>
  </head>


  <body>
    <p id="server-time"></p>

    <div class="container" style="width:100%; height:100%;">
      <div class="col-md-12 text-center align-middle" style="width:100%; height:100%;">
        <button id="mainbutton" type="button" class="btn btn-primary btn-block" style="font-size:500%; width:100%; height:100%; height:50%; position: absolute; top:25%;">
          TEST BUTTON	
        </button>
      </div>
    </div>

  </body>

  <script>

    // Use JQuery to grab our button object
    var button = $( "#mainbutton" );

    function setContinueMode(){
          button.removeClass( "btn-warning" );
          button.addClass( "btn-primary" );
        }

    function setRestartMode(){
          button.removeClass( "btn-danger" )
          button.removeClass( "btn-primary" )
          button.removeClass( "btn-success" )
          button.addClass( "btn-warning" )
        }

    function setLoserMode(){
          button.removeClass( "btn-primary" )
          button.addClass( "btn-danger" )
        }

    function setWinnerMode(){
          button.removeClass( "btn-primary" )
          button.addClass( "btn-success" )
        }

    // URL defaults to window.location
    let socket = io();
    let el;
    let currentShare = [];
    let winningNum = -1;

    socket.on('time', (timeString) => {
          el = document.getElementById('server-time');
          el.innerHTML = 'Server time: ' + timeString;
        });

    // Handle the message where we are confirmed to have registered
    socket.on('registered', (msg) => {
          console.log('Requesitng a new share');
          socket.emit('needNewShare');
        });

    // Handle incoming message for the requested share
    socket.on('newShare', (msg) => {
          console.log('Got a new share');
          currentShare = msg.share;
          winningNum = msg.winNum;

          // Let the server know we completed the share
          socket.emit('completedShare', {share:currentShare});
        });

    // On share acceptance, request a new share fo work
    socket.on('shareAccepted', (msg) => {
          socket.emit('needNewShare'); 
        });

    // On share rejection, request a new share fo work
    socket.on('shareRejected', (msg) => {
          socket.emit('needNewShare'); 
        });

    // Handle the case where we have a winner 
    socket.on('weGotAWinner', (msg) => {
          setLoserMode();
        });

    // Handle the case where we are told to idle
    socket.on('idle', (msg) => {
          setLoserMode();
        });

    // Handle the case where we are told we lost 
    socket.on('youDidNotWin', (msg) => {
          socket.emit('needNewShare'); 
        });

    // Handle the case where we ARE the winner 
    socket.on('youAreTheWinner', (msg) => {
          setWinnerMode();
        });
  </script>

</html>
