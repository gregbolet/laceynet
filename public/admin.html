<html>
    <head>
        <!-- Load Bootstrap/CSS/Popper/Jquery/Socket.io -->
        <link rel="stylesheet" href="/css/gamestyle.css"> </link>
        <link rel="stylesheet" href="/css/bootstrap.min.css"> </link>
        <link rel="stylesheet" href="/css/admin.css"> </link>
        <script src="/js/jquery-3.6.0.min.js"></script>
        <script src="/js/popper.min.js" ></script>
        <script src="/js/bootstrap.min.js" ></script>
        <script src="/socket.io/socket.io.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.3.0/mustache.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>


        
        <title>Guessing Game!</title>
    </head>

    <body>
        <nav class="navbar navbar-expand-lg sticky-top navbar-light bg-light">
            <ul class="navbar-nav ml-0">
              <li class="nav-item">
                <button class="btn btn-primary" id="restartButton">Restart Game</button>
                <button class="btn btn-info" id="refreshButton">Refresh Game Responses</button>
                <a class="btn btn-warning" href="index.html">Back To Game</a>
              </li>
            </ul>
            <p class="navbar-text ml-auto pb-0" id="server-time"></p>
          </nav>

          <div id="panel" class="container">

          </div>
          <template id="client_temp">
              <div class ="item" style="background: {{color}}">
            <p>
                {{num}}
            </p>
        </div>
          </template>
    </body>

    <script>
        //var button = $( "#mainbutton" );
        // link for grid https://stackoverflow.com/questions/43115822/can-i-make-a-css-grid-with-dynamic-number-of-rows-or-columns
        //link for rese https://stackoverflow.com/questions/61155301/how-to-remove-divs-inside-a-grid

        var restartBtn = $( "#restartButton" );
        var refreshBtn = $( "#refreshButton" );
        const COLORS = ['#FE9','#9AF','#F9A',"#AFA","#FA7"];
        const container = $('#panel');
        const tmpl = $('#client_temp').html();
        
        //resets container for display
        function resetGrid(){
            console.info("resetting grid");
            document.querySelectorAll(".item").forEach((e) => e.parentNode.removeChild(e));
        }

        //adds current clients to display page
        function addItem(container, template, clientlist) { //adds all client ids to grid EXCEPT admin
            console.info("adding items");
            resetGrid();
            var count = 1;
            for(let id in clientlist){
                let color = COLORS[_.random(COLORS.length - 1)];
                let client_num = count;
                let num = "Client " + client_num.toString() +": " + clientlist[id];
                container.append(Mustache.render(template, { color, num }));
                count++;
            }
            // for(let i =0;i<clientlist.length -1;i++) {
            //     let color = COLORS[_.random(COLORS.length - 1)];
            //     let client_num = i+1;
            //     let num = "Client " + client_num.toString() +": " + clientlist[i]; //_.random(10000);
            //     container.append(Mustache.render(template, { color, num }));
            // }
        }

         // URL defaults to window.location
        let socket = io('/admin.html');
        let el;
        let currentShare = [];
        let currentPos = -1;
        let winningNum = -1;

        restartBtn.click(function(){
            socket.emit('restartGame', {share:currentShare});
            });

        refreshBtn.click(function(){
            console.log("refresh button was clicked")
            //socket.emit('refreshResponse');
            socket.emit('askClientResponse');
        });


        socket.on('time', (timeString) => {
                el = document.getElementById('server-time');
                el.innerHTML = 'Server time: ' + timeString;
            });

        socket.on('clientssent', (msg) => { //probably dont need anymore
            addItem(container,tmpl,msg);
        });

        socket.on('getClientDict', (msg) => {
            console.log('heres the dict')
            console.log(JSON.stringify(msg));
            addItem(container,tmpl,msg);
        })

        socket.on('getClientNumber', (msg) => {
            console.log('oops mistake');
            console.info('oops mistake');
        });

    </script>
</html>